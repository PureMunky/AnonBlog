!function(){function t(t){t.when("/",{templateUrl:"partials/frontpage.html",controllerAs:"vm",bindToController:!0,controller:"MainCtrl"}).when("/write",{template:"<div ab-write></div>"}).when("/helpout",{templateUrl:"partials/helpout.html"}).when("/:id",{templateUrl:"partials/view.html"}).otherwise({redirectTo:"/"})}angular.module("app",["ngRoute"]).config(t),t.$inject=["$routeProvider"]}(),function(){function t(){}angular.module("app").controller("MainCtrl",t)}(),function(){function t(t){var e=this;e.form={comments:[]}}angular.module("app").controller("View",t),t.$inject=["Posts"]}(),function(){"use strict";function t(){function t(t,e){function n(e){t.messages.push(e)}function r(){e.sendMessage(t.post._id,t.form.message),t.form.message=""}t.messages=[],t.form={message:""},t.sendMessage=r,e.onMessage(t.post._id,n)}var e={restrict:"A",templateUrl:"partials/directives/chat.html",scope:{post:"="},controller:t};return t.$inject=["$scope","Chat"],e}angular.module("app").directive("abChat",t)}(),function(){"use strict";function t(){function t(t,e){t.form={display:!1,body:""},t.comment=function(){t.form.display=!0},t.save=function(){e.Write({Body:t.form.body,Parent:t.parent})}}var e={restrict:"A",templateUrl:"partials/directives/comment.html",scope:{parent:"="},controller:t};return t.$inject=["$scope","Posts"],e}angular.module("app").directive("abComment",t)}(),function(){"use strict";function t(){function t(t){function e(t){r.messages.push(t)}function n(){r.messages.splice(0,1)}var r=this;r.messages=[],t.addReporter(e),r.dismissMessage=n}var e={restrict:"A",scope:{},templateUrl:"partials/directives/errorDisplay.html",controllerAs:"vm",bindToController:!0,controller:t};return t.$inject=["errorMessageSvc"],e}angular.module("app").directive("abErrorDisplay",t)}(),function(){"use strict";function t(){function t(t,e){function n(){return t.GetAll()}function r(t){return t}function o(t){return t.length>300&&(t=t.substring(0,300)+"..."),e.parse(t)}var i=this;i.posts=[],i.parseBody=o,n().then(function(t){var e=0;for(e=0;e<t.length;e++)i.posts.push(r(t[e]))})}var e={restrict:"A",scope:{},templateUrl:"partials/directives/front.html",controllerAs:"vm",bindToController:!0,controller:t};return t.$inject=["Posts","textBodyService"],e}angular.module("app").directive("abFront",t)}(),function(){"use strict";function t(){function t(t,e){}var e={restrict:"A",templateUrl:"partials/directives/postComments.html",scope:{comments:"="},controller:t};return t.$inject=["$scope","Posts"],e}angular.module("app").directive("abPostComments",t)}(),function(){"use strict";function t(){function t(t,e){function n(){e.GetPromoteTime(l.post._id).then(o)}function r(){e.Promote(l.post._id).then(o)["catch"](function(t){console.log(t)})}function o(t){t&&(l.data=t,l.totalTime=l.data.totalTime,u(Math.round(l.data.remainingTime/1e3)))}function i(){m--,0>=m&&l.promoted?(l.promoted=!1,n()):0>=m?l.promoted=!1:l.promoted=!0,l.promotePercentage=a(),p&&!c()&&t.cancel(p),c()||(p=t(i,1e3))}function s(){var t="Promote me!";if(!c())switch(!0){case m>60:var e=Math.round(m/60);t=e+(1===e?" Minute":" Minutes");break;default:t="<1 Minute"}return t}function a(){var t="0%";return l.data&&(t=Math.round(100*((l.data.promotedTime-m)/(l.data.totalTime-m)))+"%"),t}function c(){return 0>=m}function u(t){m=t,i()}var l=this;l.promoted=!1,l.totalTime=-1,l.promotePercentage="0%",l.promote=r,l.getRemaining=s;var p,m;n()}var e={restrict:"A",templateUrl:"partials/directives/promote.html",scope:{post:"="},controllerAs:"vm",bindToController:!0,controller:t};return t.$inject=["$timeout","Posts"],e}angular.module("app").directive("abPromote",t)}(),function(){"use strict";function t(){function t(t,e,n,r,o){function i(){return o.parse(a.post.Body)}function s(){t.Get(n.id).then(function(t){console.log(t),a.post=t})}var a=this;a.form={comments:[]},a.PostBody=i,a.post={Title:"hello",Body:"something"},s()}var e={restrict:"A",scope:{post:"="},templateUrl:"partials/directives/view.html",controllerAs:"vm",bindToController:!0,controller:t};return t.$inject=["Posts","$scope","$routeParams","$sce","textBodyService"],e}angular.module("app").directive("abPostView",t)}(),function(){"use strict";function t(){function t(t,e){var n=this;n.post={Title:"",Body:""},n.write=function(){e.Write(n.post).then(function(e){t.path("/")})}}var e={restrict:"A",scope:{},templateUrl:"partials/directives/write.html",controllerAs:"vm",bindToController:!0,controller:t};return t.$inject=["$location","Posts"],e}angular.module("app").directive("abWrite",t)}(),function(){"use strict";function t(t){function e(t,e){a[t]||(a[t]=[]),a[t].push(e),o(t)}function n(t,e){var n=0;if(a[t])for(n=0;n<a[t].length;n++)a[t][n](e)}function r(e,n){t.Write({Body:n,Parent:e})}function o(e){c[e]=[],setInterval(function(){t.GetComments(e).then(function(t){return i(e,t.data)}).then(function(t){var r=0;for(r=0;r<t.length;r++)!function(r){n(e,t[r])}(r)})},5e3)}function i(t,e){var n=0,r=0,o=!1,i=[];for(n=0;n<e.length;n++){for(o=!1,r=0;r<c[t].length;r++)c[t][r]._id===e[n]._id&&(o=!0);o||(i.push(e[n]),c[t].push(e[n]))}return i}var s={onMessage:e,sendMessage:r},a=[],c=[];return s}angular.module("app").service("Chat",t),t.$inject=["Posts"]}(),function(){"use strict";function t(){function t(t){var e=0;for(e=0;e<o.length;e++)o[e](t)}function e(e){t(e)}function n(t){o.push(t)}var r={},o=[];return r.sendMessage=e,r.addReporter=n,r}angular.module("app").service("errorMessageSvc",t),t.$inject=[]}(),function(){"use strict";function t(t,e,n){function r(){return t.get("/post").then(u)}function o(n){var r=e.defer();return m[n]?r.resolve(m[n]):t.get("/post/"+n).then(u).then(function(t){r.resolve(t)}),r.promise}function i(e){return t.get("/post/"+e+"/comments").then(u)}function s(e){return t.post("/post",e).then(u)}function a(e){return t.post("/post/"+e+"/promote").then(l)}function c(e){return t.get("/post/"+e+"/promote").then(l)}function u(t){var e=0,r=t.data;if(r.success)if(r.data instanceof Array)for(e=0;e<r.data.length;e++)m[r.data[e]._id]=r.data[e];else r.data._id&&(m[r.data._id]=r.data);else n.sendMessage(r.message+": Error getting post data.");return r.data}function l(t){var e=t.data;return e.success||n.sendMessage(e.message||": Error getting promotion data."),e.data}var p={Promote:a,GetAll:r,Get:o,GetComments:i,Write:s,GetPromoteTime:c},m={};return p}angular.module("app").service("Posts",t),t.$inject=["$http","$q","errorMessageSvc"]}(),function(){function t(t){function e(e){var n=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;return e=e.replace("\n","<br/>"),e=e?e.replace(n,"<a href='$1' target='_blank'>$1</a>"):"",t.trustAsHtml(e)}var n={parse:e};return n}angular.module("app").service("textBodyService",t),t.$inject=["$sce"]}();